{"id":"QcRT","dependencies":[{"name":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\.babelrc","includedInParent":true,"mtime":1592906127753},{"name":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\package.json","includedInParent":true,"mtime":1592906128340},{"name":"@babel/runtime/helpers/assertThisInitialized","parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\@babel\\runtime\\helpers\\assertThisInitialized.js"},{"name":"@babel/runtime/helpers/inherits","parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\@babel\\runtime\\helpers\\inherits.js"},{"name":"@babel/runtime/helpers/possibleConstructorReturn","parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\@babel\\runtime\\helpers\\possibleConstructorReturn.js"},{"name":"@babel/runtime/helpers/getPrototypeOf","parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\@babel\\runtime\\helpers\\getPrototypeOf.js"},{"name":"@babel/runtime/helpers/typeof","parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\@babel\\runtime\\helpers\\typeof.js"},{"name":"@babel/runtime/helpers/classCallCheck","parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\@babel\\runtime\\helpers\\classCallCheck.js"},{"name":"@babel/runtime/helpers/createClass","parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\@babel\\runtime\\helpers\\createClass.js"},{"name":"three/examples/jsm/loaders/FBXLoader","loc":{"line":1,"column":26},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\three\\examples\\jsm\\loaders\\FBXLoader.js"},{"name":"three/examples/jsm/loaders/OBJLoader","loc":{"line":2,"column":26},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\three\\examples\\jsm\\loaders\\OBJLoader.js"},{"name":"three","loc":{"line":3,"column":23},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\three\\build\\three.module.js"},{"name":"socket.io-client","loc":{"line":4,"column":15},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\socket.io-client\\lib\\index.js"},{"name":"stats.js","loc":{"line":5,"column":18},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\stats.js\\build\\stats.min.js"},{"name":"../libs/toon3d.js","loc":{"line":6,"column":41},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\libs\\toon3d.js"},{"name":"postprocessing","loc":{"line":12,"column":7},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\postprocessing\\build\\postprocessing.esm.js"},{"name":"three/examples/jsm/postprocessing/AfterimagePass","loc":{"line":13,"column":31},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\three\\examples\\jsm\\postprocessing\\AfterimagePass.js"},{"name":"three/examples/jsm/helpers/PositionalAudioHelper","loc":{"line":14,"column":38},"parent":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\src\\game.js","resolved":"A:\\WEB\\MeetingHillMultiplayer\\public_html\\MeetingHill\\node_modules\\three\\examples\\jsm\\helpers\\PositionalAudioHelper.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=void 0;var e=v(require(\"@babel/runtime/helpers/assertThisInitialized\")),t=v(require(\"@babel/runtime/helpers/inherits\")),i=v(require(\"@babel/runtime/helpers/possibleConstructorReturn\")),a=v(require(\"@babel/runtime/helpers/getPrototypeOf\")),s=v(require(\"@babel/runtime/helpers/typeof\")),n=v(require(\"@babel/runtime/helpers/classCallCheck\")),o=v(require(\"@babel/runtime/helpers/createClass\")),r=require(\"three/examples/jsm/loaders/FBXLoader\"),l=require(\"three/examples/jsm/loaders/OBJLoader\"),c=y(require(\"three\")),h=v(require(\"socket.io-client\")),d=v(require(\"stats.js\")),m=require(\"../libs/toon3d.js\"),u=require(\"postprocessing\"),p=require(\"three/examples/jsm/postprocessing/AfterimagePass\"),g=require(\"three/examples/jsm/helpers/PositionalAudioHelper\");function f(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return f=function(){return e},e}function y(e){if(e&&e.__esModule)return e;if(null===e||\"object\"!=typeof e&&\"function\"!=typeof e)return{default:e};var t=f();if(t&&t.has(e))return t.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var n=a?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(i,s,n):i[s]=e[s]}return i.default=e,t&&t.set(e,i),i}function v(e){return e&&e.__esModule?e:{default:e}}function w(e){var t=b();return function(){var s,n=(0,a.default)(e);if(t){var o=(0,a.default)(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return(0,i.default)(this,s)}}function b(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function M(e,t){var i;if(\"undefined\"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=j(e))||t&&e&&\"number\"==typeof e.length){i&&(e=i);var a=0,s=function(){};return{s:s,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:s}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var n,o=!0,r=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){r=!0,n=e},f:function(){try{o||null==i.return||i.return()}finally{if(r)throw n}}}}function j(e,t){if(e){if(\"string\"==typeof e)return x(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return\"Object\"===i&&e.constructor&&(i=e.constructor.name),\"Map\"===i||\"Set\"===i?Array.from(e):\"Arguments\"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var P=function(){function e(){(0,n.default)(this,e),this.stats=new d.default,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.modes=Object.freeze({NONE:Symbol(\"none\"),PRELOAD:Symbol(\"preload\"),INITIALISING:Symbol(\"initialising\"),CREATING_LEVEL:Symbol(\"creating_level\"),ACTIVE:Symbol(\"active\"),GAMEOVER:Symbol(\"gameover\")}),this.mode=this.modes.NONE,this.container,this.player,this.cameras,this.camera,this.scene,this.renderer,this.animations={},this.assetsPath=\"assets/\",this.ring,this.ringCanvas,this.ringContext,this.remotePlayers=[],this.remoteColliders=[],this.initialisingPlayers=[],this.remoteData=[],this.messages={text:[\"Welcome to Meeting Hill\"],index:0},this.container=document.createElement(\"div\"),this.container.style.height=\"100%\",document.body.appendChild(this.container);m.SFX.supportsAudioType(\"mp3\");var t=this;this.anims=[\"Walking\",\"WalkingBackwards\",\"Turn\",\"Running\"];var i={assets:[\"\".concat(this.assetsPath,\"images/nx.jpg\"),\"\".concat(this.assetsPath,\"images/px.jpg\"),\"\".concat(this.assetsPath,\"images/ny.jpg\"),\"\".concat(this.assetsPath,\"images/py.jpg\"),\"\".concat(this.assetsPath,\"images/nz.jpg\"),\"\".concat(this.assetsPath,\"images/pz.jpg\")],oncomplete:function(){t.init()}};this.anims.forEach(function(e){i.assets.push(\"\".concat(t.assetsPath,\"fbx/anims/\").concat(e,\".fbx\"))}),i.assets.push(\"\".concat(t.assetsPath,\"fbx/anims/Idle.fbx\")),i.assets.push(\"\".concat(t.assetsPath,\"TerrainOBJ/TerrainWCollider2.obj\")),i.assets.push(\"\".concat(t.assetsPath,\"TerrainOBJ/TerrainTextureBaked.jpg\")),i.assets.push(\"\".concat(t.assetsPath,\"TerrainOBJ/WoodAlbedo2.jpg\")),i.assets.push(\"\".concat(t.assetsPath,\"TerrainOBJ/WoodRoughness.jpg\")),i.assets.push(\"\".concat(t.assetsPath,\"TerrainOBJ/rug.jpg\")),i.assets.push(\"\".concat(t.assetsPath,\"TerrainOBJ/rugAlpha.jpg\")),i.assets.push(\"\".concat(t.assetsPath,\"images/OrbBump.jpg\")),i.assets.push(\"\".concat(t.assetsPath,\"images/orbEnviromap.jpg\")),i.assets.push(\"\".concat(t.assetsPath,\"sfx/birds_short.mp3\")),i.assets.push(\"\".concat(t.assetsPath,\"sfx/808_t1.mp3\")),i.assets.push(\"\".concat(t.assetsPath,\"sfx/Clouds_1_pad.mp3\")),i.assets.push(\"\".concat(t.assetsPath,\"sfx/cold_stormy_wind.mp3\")),this.mode=this.modes.PRELOAD,this.clock=new c.Clock;var a=new m.Preloader(i);this.manager=new c.LoadingManager,this.manager.onLoad=function(){console.log(\"Loading complete!\"),a.managerDone=!0;document.getElementById(\"joystick\");document.getElementById(\"blocker\").style.display=\"block\"},window.onError=function(e){console.error(JSON.stringify(e))}}return(0,o.default)(e,[{key:\"init\",value:function(){this.mode=this.modes.INITIALISING,this.camera=new c.PerspectiveCamera(45,window.innerWidth/window.innerHeight,10,8e3),this.scene=new c.Scene,this.scene.background=new c.Color(41200);var e=new c.HemisphereLight(16772785,399921,.5);this.scene.add(e);var t=new c.DirectionalLight(16772785,.8);t.position.set(30,100,40),t.target.position.set(0,0,0),t.castShadow=!0;t.shadow.camera.near=1,t.shadow.camera.far=700,t.shadow.camera.left=t.shadow.camera.bottom=-400,t.shadow.camera.right=t.shadow.camera.top=400,t.shadow.bias=.0039,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,this.sun=t,this.scene.add(t);var i=new r.FBXLoader(this.manager),a=this;this.player=new k(this),this.loadEnvironment(i),this.createTextRing(),this.initChat(),this.renderer=new c.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement),this.initPostProcessing(),\"ontouchstart\"in window?window.addEventListener(\"touchdown\",function(e){return a.onMouseDown(e)},!1):window.addEventListener(\"mousedown\",function(e){return a.onMouseDown(e)},!1),window.addEventListener(\"resize\",function(){return a.onWindowResize()},!1)}},{key:\"initPostProcessing\",value:function(){this.composer=new u.EffectComposer(this.renderer),this.composer.addPass(new u.RenderPass(this.scene,this.camera)),this.composer.addPass(new u.EffectPass(this.camera,new u.BloomEffect))}},{key:\"initSfx\",value:function(){this.listener=new c.AudioListener;var e=new c.Object3D;e.rotation.y=180,e.add(this.listener),this.player.object.add(e),this.radioElement=document.getElementById(\"azuracast\"),this.radioElement.volume=0,this.initSpeakers()}},{key:\"initSpeakers\",value:function(){var e=new c.BoxGeometry(10,10,10),t=new c.MeshBasicMaterial({color:65280}),i=new c.Mesh(e,t);if(i.position.set(630,-50,450),null!=this.radioElement){console.log(\"found elem\");var a=new c.PositionalAudio(this.listener);a.setMediaElementSource(this.radioElement),a.setRolloffFactor(1),a.setDistanceModel(\"inverse\"),a.setRefDistance(30),a.setDirectionalCone(180,180,1),a.setVolume(7),i.add(a);var s=new g.PositionalAudioHelper(a);a.add(s)}else console.log(\"no azura cast DOM element\");this.scene.add(i),this.radioElement.volume=1;var n=new c.Mesh(e,t),o=new c.PositionalAudio(this.listener);(new c.AudioLoader).load(\"\".concat(this.assetsPath,\"sfx/birds_short.mp3\"),function(e){o.setBuffer(e),o.setRolloffFactor(1),o.setDistanceModel(\"exponential\"),o.setRefDistance(10),o.setDirectionalCone(180,180,1),o.play(),o.setLoop(!0),o.setVolume(9)});var r=new c.MeshBasicMaterial({color:16711680});(n=new c.Mesh(e,r)).position.set(-860,-170,-90),n.add(o),this.scene.add(n);var l=new c.Mesh(e,t),h=new c.PositionalAudio(this.listener);(new c.AudioLoader).load(\"\".concat(this.assetsPath,\"sfx/Clouds_1_pad.mp3\"),function(e){h.setBuffer(e),h.setRolloffFactor(.9),h.setRefDistance(5),h.setDirectionalCone(180,180,1),h.play(),h.setLoop(!0),h.setVolume(3)});var d=new c.MeshBasicMaterial({color:16711935});(l=new c.Mesh(e,d)).position.set(-455,-140,381),l.add(h),this.scene.add(l);var m=new c.Mesh(e,t),u=new c.PositionalAudio(this.listener);(new c.AudioLoader).load(\"\".concat(this.assetsPath,\"sfx/808_t1.mp3\"),function(e){u.setBuffer(e),u.setRolloffFactor(1),u.setRefDistance(15),u.setDirectionalCone(180,180,1),u.play(),u.setLoop(!0),u.setVolume(1)});var p=new c.PositionalAudio(this.listener);(new c.AudioLoader).load(\"\".concat(this.assetsPath,\"sfx/cold_stormy_wind.mp3\"),function(e){p.setBuffer(e),p.setRolloffFactor(1),p.setRefDistance(300),p.setDirectionalCone(180,180,1),p.play(),p.setLoop(!0),p.setVolume(.5)});var f=new c.MeshBasicMaterial({color:16711935});(m=new c.Mesh(e,f)).position.set(-597,138,-887),m.add(u),m.add(p),this.scene.add(m)}},{key:\"initJoystick\",value:function(){this.joystick=new m.JoyStick({onMove:this.playerControl,game:this})}},{key:\"loadEnvironment\",value:function(e){var t=this;t.colliders=[],new l.OBJLoader(this.manager).load(\"assets/TerrainOBJ/TerrainWCollider2.obj\",function(e){e.scale.set(2,2,2),e.position.set(0,0,0),e.rotation.set(0,160,0),t.environment=e,t.scene.add(e),e.traverse(function(e){if(e.isMesh){if(e.name.startsWith(\"proxy\"))t.colliders.push(e),e.material.visible=!1;else{if(e.name.startsWith(\"Polygon_Reduction\")){console.log(e.name);var i=(new c.TextureLoader).load(\"assets/TerrainOBJ/TerrainTextureBaked.jpg\");e.material=new c.MeshStandardMaterial,e.material.roughness=0,e.material.map=i}else if(e.name.startsWith(\"MainSpeaker\")){var a=(new c.TextureLoader).load(\"assets/TerrainOBJ/WoodAlbedo2.jpg\"),s=(new c.TextureLoader).load(\"assets/TerrainOBJ/WoodRoughness.jpg\");e.material=new c.MeshBasicMaterial,e.material.map=a,e.material.roughnessMap=s,e.material.roughness=1}else if(e.name.startsWith(\"Cable\"))e.material=new c.MeshBasicMaterial,e.material.color=0,e.material.transparent=!0,e.material.opacity=1,e.receiveShadow=!1;else if(e.name.startsWith(\"rug\")){var n=(new c.TextureLoader).load(\"assets/TerrainOBJ/rug.jpg\"),o=(new c.TextureLoader).load(\"assets/TerrainOBJ/rugAlpha.jpg\");e.material=new c.MeshBasicMaterial,e.material.map=n,e.material.transparent=!0,e.material.alphaMap=o}e.receiveShadow=!0}e.receiveShadow=!0}})});var i=new c.CubeTextureLoader(this.manager);i.setPath(\"\".concat(t.assetsPath,\"/images/\"));var a=i.load([\"px.jpg\",\"nx.jpg\",\"py.jpg\",\"ny.jpg\",\"pz.jpg\",\"nz.jpg\"]);t.scene.background=a,t.loadNextAnim(e)}},{key:\"loadNextAnim\",value:function(e){var t=this.anims.pop(),i=this;e.load(\"\".concat(this.assetsPath,\"fbx/anims/\").concat(t,\".fbx\"),function(a){i.player.animations[t]=a.animations[0],i.anims.length>0?i.loadNextAnim(e):(delete i.anims,i.action=\"Idle\",i.mode=i.modes.ACTIVE,i.animate())})}},{key:\"createTextRing\",value:function(){var e=new c.CylinderGeometry(512,512,256,100,1,1,!0),t=(new c.TextureLoader).load(\"assets/images/OrbBump.jpg\"),i=\"assets/images/\",a=[i+\"px.jpg\",i+\"nx.jpg\",i+\"py.jpg\",i+\"ny.jpg\",i+\"pz.jpg\",i+\"nz.jpg\"],s=(new c.CubeTextureLoader).load(a),n=new c.MeshPhysicalMaterial({color:\"#FFFFFF\",metalness:1,side:c.DoubleSide,bumpScale:.1,bumpMap:t,clearcoat:1,clearcoatRoughness:.12,roughnessMap:t,roughness:0,envMap:s,envMapIntensity:.8,premultipliedAlpha:!0,opacity:.2,transparent:!0,depthWrite:!1}),o=new c.Mesh(e,n);o.position.set(500,250,300);var r=new c.MeshBasicMaterial({color:0,side:c.DoubleSide,transparent:!0,opacity:1,fog:!1,depthWrite:!1});this.ring=new c.Mesh(e,r),this.ring.position.set(500,250,300),this.ring.rotation.y=225,this.scene.add(o),this.scene.add(this.ring),this.config={font:\"Roboto Mono\",size:15,padding:15,colour:\"#0xffffff\",width:2048,height:128},this.ringCanvas=this.createRingCanvas(this.config.width,this.config.height),this.ringContext=this.ringCanvas.getContext(\"2d\"),this.tempCanvas=this.createRingCanvas(this.config.width,this.config.height),this.tempContext=this.tempCanvas.getContext(\"2d\");var l=new c.CanvasTexture(this.ringCanvas);this.ring.material.map=l,this.initRing(\"Meeting Hill\")}},{key:\"initRing\",value:function(e){this.ringContext.font=\"\".concat(this.config.size,\"pt \").concat(this.config.font),this.ringContext.textAlign=\"centre\",this.ring.material.map.needsUpdate=!0}},{key:\"createRingCanvas\",value:function(e,t){var i=document.createElement(\"canvas\");return i.width=e,i.height=t,i}},{key:\"map_range\",value:function(e,t,i,a,s){return a+(s-a)*(e-t)/(i-t)}},{key:\"quatToEuler\",value:function(e){var t,i,a,s=new c.Vector3,n=e.w*e.w,o=e.x*e.x,r=e.y*e.y,l=e.z*e.z,h=o+r+l+n,d=e.x*e.y+e.z*e.w;return d>.499*h?(t=2*Math.atan2(e.x,e.w),i=Math.PI/2,void(a=0)):d<-.499*h?(t=-2*Math.atan2(e.x,e.w),i=-Math.PI/2,void(a=0)):(t=Math.atan2(2*e.y*e.w-2*e.x*e.z,o-r-l+n),i=Math.asin(2*d/h),a=Math.atan2(2*e.x*e.w-2*e.y*e.z,-o+r-l+n),s.z=Math.floor(1e3*i)/1e3,s.y=Math.floor(1e3*t)/1e3,s.x=Math.floor(1e3*a)/1e3,s)}},{key:\"eulerToAngle\",value:function(e){return(e>0?2*Math.PI-e:-e)/(2*Math.PI/360)}},{key:\"updateRingText\",value:function(e,t){var i=this.quatToEuler(this.player.object.quaternion),a=this.eulerToAngle(i.y);a=(a+180)%360;var s=this.map_range(a,0,360,this.config.width-50,0);this.ringContext.font=\"\".concat(this.config.size,\"pt \").concat(this.config.font),this.ringContext.textAlign=\"left\",this.ringContext.fillStyle=\"white\",this.ringContext.fillText(e,s,this.config.height-5),this.ring.material.map.needsUpdate=!0}},{key:\"updateRing\",value:function(){this.tempContext.drawImage(this.ringCanvas,0,0),this.ringContext.clearRect(0,0,this.config.width,this.config.height),this.ringContext.drawImage(this.tempCanvas,0,-1),this.tempContext.clearRect(0,0,this.config.width,this.config.height),this.ring.material.map.needsUpdate=!0}},{key:\"playerControl\",value:function(e,t){t=-t,e>.3?\"Walking\"!=this.player.action&&\"Running\"!=this.player.action&&(this.player.action=\"Walking\"):e<-.3?\"WalkingBackwards\"!=this.player.action&&(this.player.action=\"WalkingBackwards\"):(e=0,Math.abs(t)>.15?(this.updateRingText(\".\",this.player.id),\"Turn\"!=this.player.action&&(this.player.action=\"Turn\")):\"Idle\"!=this.player.action&&(this.player.action=\"Idle\")),0==e&&0==t?delete this.player.motion:this.player.motion={forward:e,turn:t},this.player.updateSocket()}},{key:\"createCameras\",value:function(){var e=new c.Object3D;e.position.set(112,100,600),e.parent=this.player.object;var t=new c.Object3D;t.position.set(0,600,-1050),t.parent=this.player.object;var i=new c.Object3D;i.position.set(0,50,-45),i.parent=this.player.object;var a=new c.Object3D;a.position.set(25,2e3,-15550),a.parent=this.player.object;var s=new c.Object3D;s.position.set(17,83,166),s.parent=this.player.object;var n=new c.Object3D;n.position.set(0,500,0),n.parent=this.player.object;var o=new c.Object3D;o.position.set(40,82,94),o.parent=this.player.object,this.cameras={front:e,back:t,wide:s,overhead:n,collect:o,chat:i,globalchat:a},this.activeCamera=this.cameras.back}},{key:\"showMessage\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=document.getElementById(\"message_text\");a.innerHTML=e,a.style.fontSize=t+\"px\";var s=document.getElementById(\"message_ok\"),n=document.getElementById(\"message\"),o=this;s.onclick=null!=i?function(){n.style.display=\"none\",i.call(o)}:function(){n.style.display=\"none\"},n.style.display=\"flex\"}},{key:\"onWindowResize\",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}},{key:\"updateRemotePlayers\",value:function(e){if(void 0!==this.remoteData&&0!=this.remoteData.length&&void 0!==this.player&&void 0!==this.player.id){var t=this,i=[],a=[];this.remoteData.forEach(function(e){var s,n;t.player.id!=e.id&&(t.initialisingPlayers.forEach(function(t){t.id==e.id&&(s=t)}),void 0===s&&(t.remotePlayers.forEach(function(t){t.id==e.id&&(n=t)}),void 0===n?t.initialisingPlayers.push(new C(t,e)):(i.push(n),a.push(n.collider))))}),this.scene.children.forEach(function(e){e.userData.remotePlayer&&null==t.getRemotePlayerById(e.userData.id)&&t.scene.remove(e)}),this.remotePlayers=i,this.remoteColliders=a,this.remotePlayers.forEach(function(t){t.update(e)})}}},{key:\"initChat\",value:function(){this.chat=document.getElementById(\"chat\"),this.chatOn=!1}},{key:\"onMouseDown\",value:function(e){if(void 0!==this.remoteColliders&&0!=this.remoteColliders.length){var t=new c.Vector2;t.x=e.clientX/this.renderer.domElement.clientWidth*2-1,t.y=-e.clientY/this.renderer.domElement.clientHeight*2+1;var i=new c.Raycaster;i.setFromCamera(t,this.camera);var a=i.intersectObjects(this.remoteColliders),s=this.chat;if(a.length>0){var n=a[0].object,o=this.remotePlayers.filter(function(e){if(void 0!==e.collider&&e.collider==n)return!0});if(o.length>0){var r=o[0];console.log(\"onMouseDown: player \".concat(r.id))}}else\"0px\"==s.style.bottom&&window.innerHeight-e.clientY>40?console.log(\"onMouseDown: No player found\"):console.log(\"onMouseDown: typing\")}}},{key:\"setGlobalChat\",value:function(e){var t=this.chat;e!=this.chatOn&&(e?(t.style.bottom=\"0px\",this.activeCamera=this.cameras.globalchat):(t.style.bottom=\"-50px\",this.activeCamera=this.cameras.back),this.chatOn=e)}},{key:\"getRemotePlayerById\",value:function(e){if(void 0!==this.remotePlayers&&0!=this.remotePlayers.length){var t=this.remotePlayers.filter(function(t){if(t.id==e)return!0});if(0!=t.length)return t[0]}}},{key:\"animate\",value:function(){var e=this,t=this.clock.getDelta();(requestAnimationFrame(function(){e.animate()}),this.stats.begin(),this.updateRemotePlayers(t),null!=this.player.mixer&&this.mode==this.modes.ACTIVE&&this.player.mixer.update(t),\"Walking\"==this.player.action)&&(Date.now()-this.player.actionTime>1e3&&this.player.motion.forward>0&&(this.player.action=\"Running\"));if(void 0!==this.player.motion&&this.player.move(t),null!=this.cameras&&null!=this.cameras.active&&void 0!==this.player&&void 0!==this.player.object){this.camera.position.lerp(this.cameras.active.getWorldPosition(new c.Vector3),.05);var i=this.player.object.position.clone();this.cameras.active==this.cameras.chat?i.y+=70:this.cameras.active==this.cameras.globalchat?i.y+=100:i.y+=50,this.camera.lookAt(i)}void 0!==this.sun&&(this.sun.position.copy(this.camera.position),this.sun.position.y+=10,this.sun.position.z+=120,this.sun.position.x+=-10),this.updateRing(),this.composer.render(this.clock.getDelta()),this.stats.end()}},{key:\"activeCamera\",set:function(e){this.cameras.active=e}}]),e}();exports.default=P;var C=function(){function e(t,i){var a,o;(0,n.default)(this,e),this.local=!0;var l=[\"Orange\",\"Pink\",\"Green\",\"Blue\",\"Red\"];if(o=l[Math.floor(Math.random()*l.length)],void 0===i){a=\"Idle\"}else\"object\"==(0,s.default)(i)?(this.local=!1,this.options=i,this.id=i.id,a=i.model,o=i.colour):a=i;this.model=a,this.colour=o,this.game=t,this.animations=this.game.animations;var h=new r.FBXLoader,d=this;d.object=new c.Object3D,d.object.position.set(-1247,-309.6,-6.8),d.object.rotation.set(0,1.2,0),d.object.scale.set(.1,.1,.1),h.load(\"\".concat(t.assetsPath,\"fbx/anims/\").concat(a,\".fbx\"),function(e){e.mixer=new c.AnimationMixer(e),d.root=e,d.mixer=e.mixer,e.name=\"Person\";var i=(new c.TextureLoader).load(\"assets/images/OrbBump.jpg\"),a=\"assets/images/\",s=[a+\"px.jpg\",a+\"nx.jpg\",a+\"py.jpg\",a+\"ny.jpg\",a+\"pz.jpg\",a+\"nz.jpg\"],n=(new c.CubeTextureLoader).load(s),r=new c.MeshPhysicalMaterial({color:\"#FFFFFF\",metalness:1,bumpScale:1,bumpMap:i,clearcoat:1,clearcoatRoughness:.32,roughness:0,envMap:n,envMapIntensity:1,premultipliedAlpha:!0,opacity:.5,transparent:!0}),l=new c.MeshPhysicalMaterial({name:\"Red\",color:16711680,roughness:.52,metalness:0,emissive:16711680,clearcoat:0,clearcoatRoughness:0}),h=new c.MeshStandardMaterial({name:\"Red\",color:16598295,roughness:.46,metalness:0,emissive:14360832}),m=new c.MeshStandardMaterial({name:\"Red\",color:16718362,roughness:.46,metalness:0,emissive:6356992}),u=new c.MeshStandardMaterial({name:\"Red\",color:16734464,roughness:.46,metalness:0,emissive:14363648}),p=new c.MeshStandardMaterial({name:\"Red\",color:16732754,roughness:.46,metalness:0,emissive:12386304}),g=new c.MeshPhysicalMaterial({name:\"Blue\",color:\"#0088ff\",roughness:.52,metalness:0,emissive:\"#0088ff\",clearcoat:0,clearcoatRoughness:0}),f=new c.MeshStandardMaterial({name:\"Blue\",color:\"#006EFF\",roughness:.46,metalness:0,emissive:\"#0062FF\"}),y=new c.MeshStandardMaterial({name:\"Blue\",color:\"#3118F2\",roughness:.46,metalness:0,emissive:\"#1310C6\"}),v=new c.MeshStandardMaterial({name:\"Blue\",color:\"#006DCC\",roughness:.46,metalness:0,emissive:\"#0025DB\"}),w=new c.MeshStandardMaterial({name:\"Blue\",color:\"#11C06E\",roughness:.46,metalness:0,emissive:\"#03C924\"}),b=new c.MeshPhysicalMaterial({name:\"Green\",color:\"#00FF33\",roughness:.52,metalness:0,emissive:\"#04FF00\",clearcoat:0,clearcoatRoughness:0}),M=new c.MeshStandardMaterial({name:\"Green\",color:\"#00FF1E\",roughness:.46,metalness:0,emissive:\"1AFF34\"}),j=new c.MeshStandardMaterial({name:\"Green\",color:\"#F2B718\",roughness:.46,metalness:0,emissive:\"#C6C010\"}),x=new c.MeshStandardMaterial({name:\"Green\",color:\"#02DE4C\",roughness:.46,metalness:0,emissive:\"#00B850\"}),P=new c.MeshStandardMaterial({name:\"Green\",color:\"#437A00\",roughness:.46,metalness:0,emissive:\"#31B800\"}),C=new c.MeshPhysicalMaterial({name:\"Pink\",color:\"#FF0040\",roughness:.52,metalness:0,emissive:\"#FF0019\",clearcoat:0,clearcoatRoughness:0}),k=new c.MeshStandardMaterial({name:\"Pink\",color:\"#FF24CF\",roughness:.46,metalness:0,emissive:\"#FE58D2\"}),S=new c.MeshStandardMaterial({name:\"Pink\",color:\"#F21818\",roughness:.46,metalness:0,emissive:\"#C61010\"}),R=new c.MeshStandardMaterial({name:\"Pink\",color:\"#DE0265\",roughness:.46,metalness:0,emissive:\"#DB0000\"}),D=new c.MeshStandardMaterial({name:\"Pink\",color:\"#9F00F5\",roughness:.46,metalness:0,emissive:\"#4900B8\"}),B=new c.MeshPhysicalMaterial({name:\"Orange\",color:\"#FF8800\",roughness:.52,metalness:0,emissive:\"#D60000\",clearcoat:0,clearcoatRoughness:0}),O=[h,f,new c.MeshStandardMaterial({name:\"Orange\",color:\"#FFD500\",roughness:.46,metalness:0,emissive:\"#D67D00\"}),M,k],F=[m,y,new c.MeshStandardMaterial({name:\"Orange\",color:\"#FF0000\",roughness:.46,metalness:0,emissive:\"#FA0000\"}),j,S],E=[u,v,new c.MeshStandardMaterial({name:\"Orange\",color:\"#F01000\",roughness:.46,metalness:0,emissive:\"#DB2100\"}),x,R],T=[p,w,new c.MeshStandardMaterial({name:\"Orange\",color:\"#FF8800\",roughness:.46,metalness:0,emissive:\"#D60000\"}),P,D];function A(e){return e.name==o}var I=[l,g,B,b,C].filter(A),L=O.filter(A),z=F.filter(A),W=E.filter(A),_=T.filter(A);if(e.traverse(function(e){e.isMesh&&(\"Sphere_2_2\"==e.name&&(e.material=r),e.castShadow=!0,e.receiveShadow=!0),\"Sphere_4\"==e.name&&I.length>0&&(e.material=I[0]),\"Sphere_3\"==e.name&&L.length>0&&(e.material=L[0]),\"Sphere_2\"==e.name&&z.length>0&&(e.material=z[0]),\"Sphere_1\"==e.name&&W.length>0&&(e.material=W[0]),\"Sphere\"==e.name&&_.length>0&&(e.material=_[0])}),d.object.add(e),void 0===d.deleted&&t.scene.add(d.object),d.local)t.createCameras(),t.sun.target=t.player.object,t.animations.Idle=e.animations[0],void 0!==d.initSocket&&d.initSocket();else{var q=new c.BoxGeometry(10,30,10),J=new c.MeshBasicMaterial({visible:!1}),N=new c.Mesh(q,J);N.name=\"Collider\",N.position.set(0,15,0),d.object.add(N),d.collider=N,d.object.userData.id=d.id,d.object.userData.remotePlayer=!0;var G=t.initialisingPlayers.splice(t.initialisingPlayers.indexOf(this),1);t.remotePlayers.push(G[0])}void 0!==t.animations.Idle&&(d.action=\"Idle\")})}return(0,o.default)(e,[{key:\"update\",value:function(e){if(this.mixer.update(e),this.game.remoteData.length>0){var t,i=!1,a=M(this.game.remoteData);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(s.id==this.id){this.object.position.set(s.x,s.y,s.z);var n=new c.Euler(s.pb,s.heading,s.pb);this.object.quaternion.setFromEuler(n),this.action=s.action,i=!0}}}catch(o){a.e(o)}finally{a.f()}i||(console.log(\"remove player \",this.game.remoteData.id),this.game.removePlayer(this))}}},{key:\"action\",set:function(e){if(this.actionName!=e){var t=this.local?this.animations[e]:c.AnimationClip.parse(c.AnimationClip.toJSON(this.animations[e])),i=this.mixer.clipAction(t);i.time=0,this.mixer.stopAllAction(),this.actionName=e,this.actionTime=Date.now(),i.fadeIn(.5),i.play()}},get:function(){return this.actionName}}]),e}(),k=function(i){(0,t.default)(s,i);var a=w(s);function s(t,i){var o;(0,n.default)(this,s),o=a.call(this,t,i);var r=(0,e.default)(o);r.inRing=!1;var l=h.default.connect();return l.on(\"setId\",function(e){r.id=e.id}),l.on(\"remoteData\",function(e){t.remoteData=e}),l.on(\"deletePlayer\",function(e){var i=t.remotePlayers.filter(function(t){if(t.id==e.id)return t});if(i.length>0){var a=t.remotePlayers.indexOf(i[0]);-1!=a&&(t.remotePlayers.splice(a,1),t.scene.remove(i[0].object))}else{if(index=t.initialisingPlayers.indexOf(e.id),-1!=index)t.initialisingPlayers[index].deleted=!0,t.initialisingPlayers.splice(index,1)}}),l.on(\"global message\",function(e){document.getElementById(\"chat\").style.bottom=\"0px\",t.updateRingText(e.message,e.id)}),$(\"#msg-form\").submit(function(e){return l.emit(\"global message\",{id:t.chatSocketId,message:$(\"#m\").val()}),$(\"#m\").val(\"\"),!1}),o.socket=l,o}return(0,o.default)(s,[{key:\"initSocket\",value:function(){this.socket.emit(\"init\",{model:this.model,colour:this.colour,x:this.object.position.x,y:this.object.position.y,z:this.object.position.z,h:this.object.rotation.y,pb:this.object.rotation.x})}},{key:\"updateSocket\",value:function(){void 0!==this.socket&&this.socket.emit(\"update\",{x:this.object.position.x,y:this.object.position.y,z:this.object.position.z,h:this.object.rotation.y,pb:this.object.rotation.x,action:this.action})}},{key:\"move\",value:function(e){var t=this.object.position.clone();t.y+=6;var i=new c.Vector3;this.object.getWorldDirection(i),this.motion.forward<0&&i.negate();var a=new c.Raycaster(t,i),s=!1,n=this.game.colliders;if(void 0!==n){var o=a.intersectObjects(n);o.length>0&&o[0].distance<5&&(s=!0)}if(!s)if(this.motion.forward>0){var r=\"Running\"==this.action?200:50;this.object.translateZ(e*r)}else this.object.translateZ(3*-e);if(void 0!==n){i.set(-1,0,0),i.applyMatrix4(this.object.matrix),i.normalize();var l=(a=new c.Raycaster(t,i)).intersectObjects(n);l.length>0&&l[0].distance<5&&this.object.translateX(10-l[0].distance),i.set(1,0,0),i.applyMatrix4(this.object.matrix),i.normalize(),(l=(a=new c.Raycaster(t,i)).intersectObjects(n)).length>0&&l[0].distance<5&&this.object.translateX(l[0].distance-10),i.set(0,-1,0),t.y+=20;if((l=(a=new c.Raycaster(t,i)).intersectObjects(n)).length>0){var h=t.y-l[0].distance;h>this.object.position.y?(this.object.position.y=.8*this.object.position.y+.2*h,this.velocityY=0):h<this.object.position.y&&(null==this.velocityY&&(this.velocityY=0),this.velocityY+=9.8*e,this.object.position.y-=this.velocityY,this.object.position.y<h&&(this.velocityY=0,this.object.position.y=h))}}this.object.rotateY(this.motion.turn*e),this.object.position.distanceTo(this.game.ring.position)<500?this.inRing=!0:this.inRing=!1,this.game.setGlobalChat(this.inRing),this.updateSocket()}}]),s}(C);"},"sourceMaps":null,"error":null,"hash":"5b2e5a25187c2d9503177cd7bfa2dac5","cacheData":{"env":{}}}